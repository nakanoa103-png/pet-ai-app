import streamlit as st
import google.generativeai as genai
from PIL import Image

# ------------------------------------------------
# 1. è¨­å®šéƒ¨åˆ†
# ------------------------------------------------
st.title("ğŸ¶ ãƒ¯ãƒ³ã«ã‚ƒã‚“ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å¸³ ğŸ±")
st.write("å†™çœŸã‚’ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ã€æœ€æ–°AIï¼ˆGemini 2.5ï¼‰ãŒãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œã‚Šã¾ã™ï¼")

api_key = st.text_input("APIã‚­ãƒ¼ã‚’å…¥ã‚Œã¦ã­", type="password")

# ------------------------------------------------
# 2. ç”»é¢ã‚’ä½œã‚‹éƒ¨åˆ†
# ------------------------------------------------
uploaded_file = st.file_uploader("ãƒšãƒƒãƒˆã®å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã­", type=["jpg", "jpeg", "png"])

if uploaded_file is not None and api_key:
    image = Image.open(uploaded_file)
    st.image(image, caption='ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå†™çœŸ', use_container_width=True)

    # ------------------------------------------------
    # 3. AIã«ãŠé¡˜ã„ã™ã‚‹éƒ¨åˆ†
    # ------------------------------------------------
    if st.button("AIè¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆï¼"):
        with st.spinner("æœ€æ–°ãƒ¢ãƒ‡ãƒ«(Gemini 2.5)ãŒè€ƒãˆä¸­..."):
            try:
                genai.configure(api_key=api_key)
                
                # Gemini 2.5 Proã‚’æŒ‡å®š
                model = genai.GenerativeModel('gemini-2.5-pro') 

                prompt = """
                ã“ã®ç”»åƒã‚’åˆ†æã—ã¦ã€ä»¥ä¸‹ã®é …ç›®ã‚’ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚’äº¤ãˆã¦ç­”ãˆã¦ãã ã•ã„ã€‚
                çŠ¬ã‚„çŒ«ã§ãªã„å ´åˆã¯ã€ŒçŠ¬ã‹çŒ«ã®å†™çœŸã‚’è¦‹ã›ã¦ãƒ¯ãƒ³ï¼ã€ã¨ç­”ãˆã¦ãã ã•ã„ã€‚
                
                1. ã€ç¨®é¡ã€‘ï¼ˆçŠ¬ç¨®ãƒ»çŒ«ç¨®ï¼‰
                2. ã€æ¨å®šå¹´é½¢ã€‘ï¼ˆè¦‹ãŸç›®ã‹ã‚‰ã®å‹æ‰‹ãªæ¨æ¸¬ï¼‰
                3. ã€æ€§åˆ¥ã€‘ï¼ˆé›°å›²æ°—ã‹ã‚‰ã®æ¨æ¸¬ï¼‰
                4. ã€æ€§æ ¼ã€‘ï¼ˆé¡”ã¤ãã‹ã‚‰æƒ³åƒã™ã‚‹æ€§æ ¼ï¼‰
                5. ã€ä»Šã®æ°—æŒã¡ã€‘ï¼ˆã‚»ãƒªãƒ•é¢¨ã«ï¼‰
                """

                response = model.generate_content([prompt, image])
                st.success("è¨ºæ–­å®Œäº†ï¼")
                st.write(response.text)

            except Exception as e:
                st.error(f"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")

elif not api_key:
    st.info("ã¾ãšã¯APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ã­ï¼")